(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[586],{"4aTO":function(e,t,o){o.r(t),o.d(t,"track",(function(){return y}));var a=o("q1tI"),i=o("/MKj"),n=o("gxu6"),s=o("9Hil"),c=o("mp1x"),l=o("g6r8"),r=o("6adH"),u=o("J8m7"),d=o("qpbZ"),b=o("3h4M"),g=o("AGnR"),m=o("ulr2"),p=o("QAzJ"),_=o("yweb"),h=o("h7e3"),w=o("rvfI"),j=o("28DW"),f=o("n6mq"),k=o("ANjH"),O=o("Q5BC"),A=o("nKUr");const y=(e,t,o)=>{Object(j.j)(`${o?o+".":""}mweb_autologin.${t}_${e}`),"attempt"===e&&Object(j.g)({action:"autologin",event:"attempt",type:t})};class v extends a.Component{constructor(...e){var t,o,a;super(...e),a={fbEmail:null,fbName:null,showFbAutoLoginModal:!1,facebookAutologinFailed:!1,googleAutologinFailed:!1,smartlockAutologinFailed:!1},(o="state")in(t=this)?Object.defineProperty(t,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[o]=a}componentDidUpdate(e,t){const{trackAutologinFailure:o}=this.props,{facebookAutologinFailed:a,googleAutologinFailed:i,smartlockAutologinFailed:n}=this.state,{facebookAutologinFailed:s,googleAutologinFailed:c,smartlockAutologinFailed:l}=t;s===a&&c===i&&l===n||a&&i&&n&&o()}componentDidMount(){const{isAuthenticated:e,crossDomain:t,fb:o,smartlock:a,mwebFacebookDisabled:i}=this.props;e||(n.a("fba")?Object(j.j)("mweb_previously_logged_out.true"):Object(j.j)("mweb_previously_logged_out.false"),t&&this.attemptCrossDomainAutologin(),a&&this.attemptSmartlockAutologin(),o&&!i&&this.attemptFBAutologin())}attemptCrossDomainAutologin(){if("undefined"!=typeof window&&window.PINTEREST_DISABLE_CCTLD_AUTO)return void Object(j.j)("dev.autologin_disabled.cctld");const{logPrefix:e}=this.props,t=()=>y("attempt","cctld",e),o=()=>y("success","cctld",e),a=()=>y("fail","cctld",e);try{Object(w.a)({onAttempt:t}).then(O.a).then(o).then(()=>{"undefined"!=typeof window&&window.location&&window.location.reload()}).catch(e=>{e&&a()})}catch(i){a()}}attemptSmartlockAutologin(){if("undefined"!=typeof window&&window.PINTEREST_DISABLE_SMARTLOCK_AUTO)return void Object(j.j)("dev.autologin_disabled.smartlock");const{smartLockUseAlternativeResourceCall:e,history:t,location:o,login:a,logPrefix:i}=this.props;Object(w.d)({onAttempt:()=>y("attempt","smartlock",i),onNoBrowserCredentials:()=>y("error_no_api","smartlock",i)}).then(n=>{n?(Object(g.e)({event_type:7534,view_type:10,view_parameter:3204,aux_data:{signup_login_method:5}}),a({username_or_email:n.id,password:n.password},t,o.pathname,{isAutologin:!0,useAlternativeResourceCall:e}).then(()=>{y("success","smartlock",i),Object(g.e)({event_type:7536,view_type:10,view_parameter:3204,aux_data:{signup_login_method:5}})}).catch(()=>{y("fail","smartlock",i),Object(g.e)({event_type:7535,view_type:10,view_parameter:3204,aux_data:{signup_login_method:5}}),this.setState({smartlockAutologinFailed:!0})})):(this.setState({smartlockAutologinFailed:!0}),y("error_no_creds","smartlock",i))}).catch(e=>{this.setState({smartlockAutologinFailed:!0}),y(e?e.status:"error_other","smartlock",i)})}handleFBAutologinResponse(e){const{logPrefix:t}=this.props;y(e,"facebook",t)}handleFBAutologinError(e){let t;e?e.status?t=e.status:e instanceof Error?(t="error_no_status",Object(b.b)({message:e.message||e.description,line:e.lineno||e.lineNumber||e.line,column:e.colno||e.columnNumber||e.column,stack:e.stack||e.stacktrace||e.error&&(e.error.stack||e.error.stacktrace),filename:e.fileName||e.sourceUrl,name:"unexpected mweb facebook autologin response error"})):"string"==typeof e?(t="error_string",Object(b.b)({message:e,name:"unexpected mweb facebook autologin response string"})):t="error_other":t="error_empty",this.handleFBAutologinResponse(t)}attemptFBAutologin(){if("undefined"!=typeof window&&window.PINTEREST_DISABLE_FB_AUTO)return Object(j.j)("dev.autologin_disabled.facebook"),void Object(h.a)("facebook_autologin","autologin_disabled");const{history:e,locale:t,location:o,login:a,logPrefix:i,showToast:n}=this.props;y("attempt","facebook",i),Object(h.b)("facebook_autologin","autoLoginFacebookStart"),Object(w.b)(t,e=>Object(j.j)(e)).then(t=>{Object(h.b)("facebook_autologin","autoLoginFacebookEnd"),this.setState({showFbAutoLoginModal:!0,fbEmail:t.data&&t.data.email,fbName:t.data&&t.data.first_name}),Object(g.e)({event_type:7534,view_type:10,view_parameter:3205,aux_data:{signup_login_method:2}}),Object(h.d)("facebook_autologin"),a(t.creds,e,o.pathname,{isAutologin:!0}).then(()=>{this.setState({showFbAutoLoginModal:!1}),Object(g.e)({event_type:7536,view_type:10,view_parameter:3205,aux_data:{signup_login_method:2}}),n({text:t.data&&t.data.first_name?Object(d.b)(this.props.i18n._("Welcome back to Pinterest, {{ name }}!","welcoming user back to pinterest when autologin with first name","welcoming user back to pinterest when autologin with first name"),{name:t.data.first_name}).join(""):this.props.i18n._("Welcome back to Pinterest!","welcoming user back to pinterest when autologin","welcoming user back to pinterest when autologin"),duration:4e3}),this.handleFBAutologinResponse("success")}).catch(e=>{this.setState({showFbAutoLoginModal:!1,facebookAutologinFailed:!0}),Object(g.e)({event_type:7535,view_type:10,view_parameter:3205,aux_data:{signup_login_method:2}});let t="fail";e&&e.apiErrorCode===u.l&&(t="incomplete_signup"),this.handleFBAutologinResponse(t)})}).catch(e=>{Object(h.a)("facebook_autologin","autoLoginFacebookFailed"),this.handleFBAutologinError(e),this.setState({facebookAutologinFailed:!0})})}render(){const{i18n:e}=this.props,{fbEmail:t,fbName:o,showFbAutoLoginModal:a}=this.state;return Object(A.jsx)(c.a,{isOpen:a,type:"autologin",children:Object(A.jsxs)(f.f,{margin:-3,children:[Object(A.jsx)(s.a,{duration:1500,finalProgress:95}),Object(A.jsxs)(f.f,{alignItems:"center",direction:"column",display:"flex",paddingX:t?10:12,paddingY:6,children:[Object(A.jsx)(f.w,{icon:"pinterest",color:"red",accessibilityLabel:e._("Pinterest logo"),size:24}),Object(A.jsx)(f.f,{marginTop:1,paddingY:1,children:Object(A.jsx)(f.bb,{align:"center",children:Object(A.jsx)(f.v,{size:"md",children:o?Object(d.b)(this.props.i18n._("Welcome back, {{ name }}!","welcome back with first name","welcome back with first name"),{name:o}).join(""):this.props.i18n._("Welcome back!","Welcome back!","Welcome back!")})})}),Object(A.jsx)(f.bb,{align:"center",children:t?Object(d.b)(this.props.i18n._("We're logging you in with your Facebook account, {{ email }}","logging in user with facebook account and email associated","logging in user with facebook account and email associated"),{email:Object(A.jsx)(f.bb,{inline:!0,weight:"bold",children:t},"fbEmail")}):this.props.i18n._("We're logging you in with your Facebook account...","logging in user with Facebook account","logging in user with Facebook account")})]})]})})}}t.default=Object(k.compose)(r.b,Object(i.connect)((e,t)=>({isAuthenticated:e.session.isAuthenticated,locale:e.session.locale}),e=>({login:(t,o,a,i)=>e(Object(O.b)(t,o,a,i)),crossDomainAutoLogin:()=>e(Object(O.a)()),trackAutologinFailure:()=>e(Object(m.T)())})))((function(e){const t=Object(_.c)(),o=Object(l.a)(),{anyEnabled:a}=Object(p.c)("mweb_facebook_disabled");return Object(A.jsx)(v,{...e,smartLockUseAlternativeResourceCall:"desktop"===o,mwebFacebookDisabled:a,i18n:t})}))},rvfI:function(e,t,o){o.d(t,"d",(function(){return c})),o.d(t,"b",(function(){return l})),o.d(t,"c",(function(){return r})),o.d(t,"a",(function(){return u}));var a=o("bKKl"),i=o("2hay"),n=o("4NbJ"),s=o("A+Hl");const c=(e={},t)=>{const o=window.navigator.credentials,i={password:!0};return t&&(i.mediation=t),Object(a.a)()?Promise.reject({status:"autologin_disabled"}):new Promise((t,a)=>{o?(e&&e.onAttempt&&e.onAttempt(),o.get(i).then(t).catch(a)):e&&e.onNoBrowserCredentials&&e.onNoBrowserCredentials()})},l=(e,t)=>Object(a.a)()?Promise.reject({status:"autologin_disabled"}):(t("unauth_mweb.facebook_connect.autologin.attempt"),Object(i.f)(e).then(i.d).then(e=>Object(i.e)(e,{autologin:!0},e=>t("unauth_mweb.facebook_connect.autologin."+e)))),r=(e,t)=>{if(Object(a.a)())return Promise.reject({status:"autologin_disabled"});t("create_google_autologin_button.number_6");const o=document.createElement("div");return o&&o.style&&(o.style.left="-99999px",o.style.opacity="0",o.style.position="fixed",o.style.top="-999999px"),o.id="google-autologin-button",document.getElementsByTagName("body")[0].appendChild(o),Object(n.d)(o.id,e,t,!0)},u=(e={})=>Object(s.c)(window.location.origin)?Object(a.a)()?Promise.reject({status:"autologin_disabled"}):(e&&e.onAttempt&&e.onAttempt(),Object(s.d)()):Promise.reject({status:"non_valid_origin"})}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/586-4e39877bd11c4f132c7d.mjs.map